<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eyüp Ensar Erkul - Geleceğin Projeleri</title>
    <style>
        /* Genel Stiller */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        .container {
            width: 85%;
            margin: auto;
            overflow: hidden;
            padding: 20px 0;
        }

        /* Başlık / Navbar */
        header {
            background: #2c3e50;
            color: #fff;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        header .profile-name {
            margin: 0;
            font-size: 2.8em;
            letter-spacing: 1px;
        }

        header .tagline {
            font-size: 1.1em;
            margin-top: 5px;
            opacity: 0.9;
        }

        nav ul {
            padding: 0;
            list-style: none;
            margin-top: 15px;
        }

        nav ul li {
            display: inline;
            margin: 0 15px;
        }

        nav ul li a {
            color: #fff;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1em;
            transition: color 0.3s ease;
        }

        nav ul li a:hover {
            color: #1abc9c; /* Turkuaz tonu */
        }

        /* Hakkında Bölümü */
        #about {
            background: #fff;
            padding: 60px 0;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }

        #about img {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 25px;
            border: 5px solid #1abc9c;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        #about h2 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        #about p {
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.1em;
            color: #555;
        }

        /* Projeler Bölümü */
        #projects {
            padding: 60px 0;
            background-color: #f9f9f9;
            text-align: center;
        }

        #projects h2 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 40px;
        }

        .project-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .project-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-align: left;
        }

        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .project-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .project-content {
            padding: 25px;
        }

        .project-content h3 {
            font-size: 1.8em;
            color: #1abc9c;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .project-content p {
            font-size: 1em;
            color: #666;
            margin-bottom: 15px;
        }

        .project-content a {
            display: inline-block;
            background: #2c3e50;
            color: #fff;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        .project-content a:hover {
            background: #1abc9c;
        }

        /* İletişim Bölümü */
        #contact {
            background: #2c3e50;
            color: #fff;
            padding: 60px 0;
            text-align: center;
        }

        #contact h2 {
            font-size: 2.5em;
            margin-bottom: 30px;
        }

        #contact p {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        #contact a {
            color: #1abc9c;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        #contact a:hover {
            color: #fff;
        }

        .social-icons {
            margin-top: 30px;
        }

        .social-icons a {
            color: #fff;
            font-size: 2.5em;
            margin: 0 15px;
            transition: color 0.3s ease;
        }

        .social-icons a:hover {
            color: #1abc9c;
        }

        /* Alt Bilgi */
        footer {
            background: #34495e;
            color: #fff;
            text-align: center;
            padding: 20px 0;
            font-size: 0.9em;
        }

        /* Duyarlı Tasarım */
        @media (max-width: 768px) {
            header .profile-name {
                font-size: 2.2em;
            }
            header .tagline {
                font-size: 1em;
            }
            nav ul li {
                display: block;
                margin: 10px 0;
            }
            #about h2, #projects h2, #contact h2 {
                font-size: 2em;
            }
            .project-grid {
                grid-template-columns: 1fr;
            }
            .project-card {
                margin: 0 auto;
            }
            .social-icons a {
                font-size: 2em;
                margin: 0 10px;
            }
        }
        
        /* OYUN KONTROLLERİ VE TAM EKRAN DÜĞMESİ İÇİN EK STİLLER */
        .game-controls {
            display: none; /* Varsayılan olarak gizli, sadece mobil cihazlarda gösterilecek */
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: center; /* Ortaya hizalamak için değiştirildi */
            align-items: flex-end;
            pointer-events: none; /* Tuval üzerindeki tıklamaların game-controls'u değil, tuvali etkilemesini sağlar */
            z-index: 10;
            padding: 0 10px;
            box-sizing: border-box;
            gap: 20%; /* Tuş grupları arasına daha fazla boşluk koymak için */
        }

        .game-controls .control-group {
            display: flex;
            flex-direction: column;
            pointer-events: auto; /* Kontrol grupları tıklama olaylarını algılayabilir */
        }
        
        .game-controls .move-controls {
            display: flex;
            flex-direction: row; /* Sol ve Sağ tuşları yan yana */
            justify-content: center; /* Sola yaslı */
            gap: 10px;
        }
        
        .game-controls .speed-controls {
            display: flex;
            flex-direction: column;
            justify-content: center; /* Sağa yaslı */
            align-items: center;
            gap: 10px;
        }

        .control-button {
            background-color: rgba(44, 62, 80, 0.7); /* Yarı şeffaf arka plan */
            color: #fff;
            border: 2px solid #fff;
            border-radius: 50%;
            width: 90px; /* Daha büyük */
            height: 90px; /* Daha büyük */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 38px; /* Daha büyük */
            cursor: pointer;
            user-select: none; /* Seçimi engelleme */
            transition: background-color 0.3s ease, transform 0.1s ease;
        }

        .control-button:active {
            background-color: rgba(26, 188, 156, 0.9); /* Basıldığında renk değiştir */
            transform: scale(0.95);
        }
        
        .top-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .top-controls button {
            background-color: rgba(44, 62, 80, 0.7);
            color: #fff;
            border: 2px solid #fff;
            border-radius: 5px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        .top-controls button:hover {
            background-color: rgba(26, 188, 156, 0.9);
        }

        /* Mobil cihazlar için kontrol tuşlarını göster */
        @media (max-width: 768px) {
            .game-controls {
                display: flex;
            }
        }
    </style>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1 class="profile-name">Eyüp Ensar Erkul</h1>
            <p class="tagline">13 Yaşında, Büyük Ufuklara Açılan Bir Gelecek!</p>
            <nav>
                <ul>
                    <li><a href="#about">Hakkımda</a></li>
                    <li><a href="#projects">Projelerim</a></li>
                    <li><a href="#contact">İletişim</a></li>
                    <li><a href="#game-3d">3D Oyun</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section id="about">
            <div class="container">
                <img src="https://via.placeholder.com/180/1abc9c/ffffff?text=EEY" alt="Eyüp Ensar Erkul">
                <h2>Merhaba! Ben Eyüp Ensar Erkul.</h2>
                <p>
                    13 yaşındayım ama hayallerim ve öğrenme hevesim yaşımın çok ötesinde. Kod yazmaktan, yeni teknolojileri keşfetmekten ve geleceğe yön verecek projeler geliştirmekten büyük keyif alıyorum. Her gün kendimi geliştirmek için çalışıyor, büyük ufuklara yelken açıyorum! Bu portfolyo, şimdiye kadar yaptığım ve gelecekte yapacağım projelerin bir başlangıcı.
                </p>
            </div>
        </section>

        <section id="projects">
            <div class="container">
                <h2>Projelerim</h2>
                <div class="project-grid">
                    <div class="project-card">
                        <img src="https://via.placeholder.com/400x200/2980b9/ffffff?text=Web+Sitesi+Projesi+1" alt="Web Sitesi Projesi 1">
                        <div class="project-content">
                            <h3>HTML/CSS Web Sitesi</h3>
                            <p>İlk HTML ve CSS kullanarak geliştirdiğim basit bir web sitesi projesi. Temel tasarım prensiplerini ve kodlama mantığını öğrendim.</p>
                            <a href="#" target="_blank">Detayları Gör</a>
                        </div>
                    </div>

                    <div class="project-card">
                        <img src="https://via.placeholder.com/400x200/8e44ad/ffffff?text=Restorant+WebSitesi+2" alt="Restorant WebSitesi 2">
                        <div class="project-content">
                            <h3>Basit Python Uygulaması</h3>
                            <p>Canva üzerinden Canvanın sınırlarını aşarak bir restoran sitesi yaptım sitede canlı sohbet gibi yenilikçi şeyler ekledim.</p>
                            <a href="#" target="_blank">Detayları Gör</a>
                        </div>
                    </div>

                    <div class="project-card">
                        <img src="https://via.placeholder.com/400x200/d35400/ffffff?text=Oyun+Geliştirme+3" alt="Oyun Geliştirme 3">
                        <div class="project-content">
                            <h3>Scratch ile Oyun</h3>
                            <p>Scratch platformunda basit bir interaktif oyun tasarladım. Karakter animasyonları ve puanlama sistemi ekledim.</p>
                            <a href="#" target="_blank">Detayları Gör</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="contact">
            <div class="container">
                <h2>Bana Ulaşın</h2>
                <p>Yeni fikirler ve projeler hakkında konuşmaktan mutluluk duyarım. Bana ulaşmaktan çekinme!</p>
                <p>E-posta: <a href="mailto:eposta@example.com">eposta@example.com</a></p>
                <div class="social-icons">
                    <a href="https://github.com/eyupensarerkul" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
                    <a href="https://linkedin.com/in/eyupensarerkul" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
                    <a href="https://sosyal.teknofest.app/eyupensarerkul" target="_blank" title="Next Sosyal"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
        </section>

        ---
        
        <section id="game-3d" style="text-align: center; padding: 40px 0; background-color: #f0f2f5;">
            <div class="container">
                <h2>3D Araba Sollama Oyunu</h2>
                <p>Oynamak için tuvale tıkla veya aşağıdaki kontrol tuşlarını kullan.</p>
                <div id="game-container" style="width: 100%; height: 500px; max-width: 800px; margin: 0 auto; border: 5px solid #2c3e50; border-radius: 10px; position: relative;">
                    <div class="game-controls">
                        <div class="move-controls control-group">
                            <button class="control-button" id="left-button"><i class="fas fa-arrow-left"></i></button>
                            <button class="control-button" id="right-button"><i class="fas fa-arrow-right"></i></button>
                        </div>
                        <div class="speed-controls control-group">
                            <button class="control-button" id="gas-button"><i class="fas fa-caret-up"></i></button>
                            <button class="control-button" id="brake-button"><i class="fas fa-caret-down"></i></button>
                        </div>
                    </div>
                    <div class="top-controls">
                      <button id="pause-button">Duraklat</button>
                      <button id="fullscreen-button">Tam Ekran</button>
                    </div>
                </div>
                <div style="margin-top: 15px; font-size: 1.2em; font-weight: bold;">
                    <p>Puan: <span id="score-3d">0</span></p>
                    <p id="gameOverText-3d" style="color: red; display: none;">Oyun Bitti! Sayfayı yenileyerek tekrar oyna.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Eyüp Ensar Erkul. Tüm Hakları Saklıdır.</p>
        </div>
    </footer>

    <script type="module">
        // THREE.js ve GLTFLoader modüllerini import ediyoruz.
        import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.126.0/build/three.module.js';
        import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.126.0/examples/jsm/loaders/GLTFLoader.js';

        const gameContainer = document.getElementById('game-container');
        const scoreElement = document.getElementById('score-3d');
        const gameOverText = document.getElementById('gameOverText-3d');
        const fullscreenButton = document.getElementById('fullscreen-button');
        const pauseButton = document.getElementById('pause-button');
        
        // Ekrana eklenen kontrol tuşlarını seçiyoruz
        const leftButton = document.getElementById('left-button');
        const rightButton = document.getElementById('right-button');
        const gasButton = document.getElementById('gas-button');
        const brakeButton = document.getElementById('brake-button');

        let scene, camera, renderer, playerCar, road, gameRunning = false, score = 0, isPaused = false;
        const otherCars = [];
        const environmentObjects = [];
        
        let playerSpeed = 0.15;
        let targetSpeed = 0.15;
        const maxSpeed = 0.3;
        const minSpeed = 0.08;
        
        let lateralVelocity = 0;
        const lateralAcceleration = 0.005;
        const lateralDeceleration = 0.02;
        const maxLateralSpeed = 0.05;

        const roadWidth = 6.3;
        const playerXMin = -(roadWidth / 2) + 0.5;
        const playerXMax = (roadWidth / 2) - 0.5;
        
        // DİNAMİK YÜKLEME İÇİN DEĞİŞKENLER
        const spawnDistance = 50; // Yeni objelerin ne kadar mesafede yükleneceği
        const despawnDistance = 10; // Objelerin ne kadar mesafede silineceği

        const carModelUrl = 'https://threejs.org/examples/models/gltf/car.gltf';
        let playerCarModel, obstacleCarModel;

        const loader = new GLTFLoader();

        const defaultCameraFov = 90;
        const defaultCameraPosition = new THREE.Vector3(0, 3, 7);
        const pauseCameraFov = 110;
        const pauseCameraPosition = new THREE.Vector3(0, 5, 10);
        
        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87ceeb);

            camera = new THREE.PerspectiveCamera(defaultCameraFov, gameContainer.clientWidth / gameContainer.clientHeight, 0.1, 1000);
            camera.position.copy(defaultCameraPosition);
            camera.rotation.x = -Math.PI / 8;

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(0, 10, 5);
            scene.add(directionalLight);

            const roadGeometry = new THREE.BoxGeometry(roadWidth, 0.1, 1000);
            const roadMaterial = new THREE.MeshLambertMaterial({ color: 0x4a6566 });
            road = new THREE.Mesh(roadGeometry, roadMaterial);
            road.position.z = -500;
            scene.add(road);

            const roadLines = [];
            for (let i = -500; i < 500; i += 2) {
                const lineGeometry = new THREE.BoxGeometry(0.1, 0.1, 1);
                const lineMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
                
                const line1 = new THREE.Mesh(lineGeometry, lineMaterial);
                line1.position.set(-2.1, 0.06, i);
                scene.add(line1);
                roadLines.push(line1);
                
                const line2 = new THREE.Mesh(lineGeometry, lineMaterial);
                line2.position.set(-0.7, 0.06, i);
                scene.add(line2);
                roadLines.push(line2);

                const line3 = new THREE.Mesh(lineGeometry, lineMaterial);
                line3.position.set(0.7, 0.06, i);
                scene.add(line3);
                roadLines.push(line3);

                const line4 = new THREE.Mesh(lineGeometry, lineMaterial);
                line4.position.set(2.1, 0.06, i);
                scene.add(line4);
                roadLines.push(line4);
            }
            window.roadLines = roadLines;
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(gameContainer.clientWidth, gameContainer.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            gameContainer.appendChild(renderer.domElement);

            loadModels();

            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            window.addEventListener('resize', onResize);
            gameContainer.addEventListener('click', startGame);

            leftButton.addEventListener('touchstart', (e) => { e.preventDefault(); onButtonPress('left'); });
            rightButton.addEventListener('touchstart', (e) => { e.preventDefault(); onButtonPress('right'); });
            gasButton.addEventListener('touchstart', (e) => { e.preventDefault(); onButtonPress('gas'); });
            brakeButton.addEventListener('touchstart', (e) => { e.preventDefault(); onButtonPress('brake'); });

            leftButton.addEventListener('touchend', (e) => { e.preventDefault(); onButtonRelease('left'); });
            rightButton.addEventListener('touchend', (e) => { e.preventDefault(); onButtonRelease('right'); });
            gasButton.addEventListener('touchend', (e) => { e.preventDefault(); onButtonRelease('gas'); });
            brakeButton.addEventListener('touchend', (e) => { e.preventDefault(); onButtonRelease('brake'); });
            
            leftButton.addEventListener('mousedown', () => onButtonPress('left'));
            leftButton.addEventListener('mouseup', () => onButtonRelease('left'));
            leftButton.addEventListener('mouseout', () => onButtonRelease('left'));
            rightButton.addEventListener('mousedown', () => onButtonPress('right'));
            rightButton.addEventListener('mouseup', () => onButtonRelease('right'));
            rightButton.addEventListener('mouseout', () => onButtonRelease('right'));
            gasButton.addEventListener('mousedown', () => onButtonPress('gas'));
            gasButton.addEventListener('mouseup', () => onButtonRelease('gas'));
            gasButton.addEventListener('mouseout', () => onButtonRelease('gas'));
            brakeButton.addEventListener('mousedown', () => onButtonPress('brake'));
            brakeButton.addEventListener('mouseup', () => onButtonRelease('brake'));
            brakeButton.addEventListener('mouseout', () => onButtonRelease('brake'));

            fullscreenButton.addEventListener('click', toggleFullscreen);
            pauseButton.addEventListener('click', togglePause);
        }

        function loadModels() {
            loader.load(carModelUrl, function(gltf) {
                playerCarModel = gltf.scene;
                playerCarModel.scale.set(0.01, 0.01, 0.01);
                playerCarModel.position.set(0, 0.25, 4);
                playerCarModel.rotation.y = Math.PI;
                scene.add(playerCarModel);
                playerCar = playerCarModel;

                obstacleCarModel = gltf.scene.clone(); 
                spawnInitialCars();
                spawnInitialEnvironmentObjects();
                animate();
            }, undefined, function(error) {
                console.error(error);
                console.log("3D model yüklenemedi, varsayılan kutu modelleri kullanılıyor.");
                playerCar = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.5, 1), new THREE.MeshLambertMaterial({ color: 0x27ae60 }));
                playerCar.position.set(0, 0.25, 4);
                scene.add(playerCar);
                
                obstacleCarModel = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.5, 1), new THREE.MeshLambertMaterial({ color: 0xe74c3c }));
                spawnInitialCars();
                spawnInitialEnvironmentObjects();
                animate();
            });
        }

        function createBillboardTexture(text) {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 256;
            const context = canvas.getContext('2d');
            context.fillStyle = '#2c3e50';
            context.fillRect(0, 0, canvas.width, canvas.height);
            context.font = 'bold 48px Arial';
            context.fillStyle = '#1abc9c';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText(text, canvas.width / 2, canvas.height / 2);
            return new THREE.CanvasTexture(canvas);
        }

        function createTree() {
            const trunkGeometry = new THREE.CylinderGeometry(0.2, 0.2, 2, 8);
            const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8b4513 });
            const leafGeometry = new THREE.ConeGeometry(1, 2, 8);
            const leafMaterial = new THREE.MeshLambertMaterial({ color: 0x228b22 });
            const baseGeometry = new THREE.BoxGeometry(2, 0.1, 2);
            const baseMaterial = new THREE.MeshLambertMaterial({ color: 0x228b22 });

            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            const leaves = new THREE.Mesh(leafGeometry, leafMaterial);
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            
            leaves.position.y = 1.5;
            trunk.position.y = 1;
            base.position.y = 0.05;

            const tree = new THREE.Group();
            tree.add(trunk);
            tree.add(leaves);
            tree.add(base);
            return tree;
        }

        function createBillboard() {
            const billboardGeometry = new THREE.BoxGeometry(4, 2, 0.2);
            const billboardTexture = createBillboardTexture('Eyvallah Turkish Restaurant');
            const billboardMaterial = new THREE.MeshBasicMaterial({ map: billboardTexture });
            const billboardMesh = new THREE.Mesh(billboardGeometry, billboardMaterial);
            billboardMesh.position.y = 2;
            return billboardMesh;
        }
        
        function spawnInitialCars() {
            for (let i = 0; i < 20; i++) {
                spawnNewCar();
            }
        }
        
        function spawnNewCar() {
            let car;
            if (obstacleCarModel && obstacleCarModel.type === 'Scene') { 
                car = obstacleCarModel.clone();
                car.scale.set(0.01, 0.01, 0.01);
                car.rotation.y = Math.PI;
            } else {
                car = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.5, 1), new THREE.MeshLambertMaterial({ color: Math.random() * 0xffffff }));
            }
            const laneIndex = (Math.floor(Math.random() * 6) - 2.5) * 1.4;
            const zPosition = camera.position.z - spawnDistance - Math.random() * 50;
            car.position.set(laneIndex, 0.25, zPosition);
            car.speed = (Math.random() * 0.1) + 0.1; // Rastgele hız
            scene.add(car);
            otherCars.push(car);
        }
        
        function spawnInitialEnvironmentObjects() {
            for (let i = 0; i < 50; i++) {
                spawnNewEnvironmentObject();
            }
        }
        
        function spawnNewEnvironmentObject() {
            let obj;
            if (Math.random() > 0.9) {
                obj = createBillboard();
                obj.position.x = (Math.random() > 0.5 ? 1 : -1) * (roadWidth / 2 + 3);
            } else {
                obj = createTree();
                obj.position.x = (Math.random() > 0.5 ? 1 : -1) * (roadWidth / 2 + 1 + Math.random() * 5);
            }
            obj.position.z = camera.position.z - spawnDistance - Math.random() * 100;
            scene.add(obj);
            environmentObjects.push(obj);
        }

        function startGame() {
            if (gameRunning) return;
            gameRunning = true;
            score = 0;
            playerSpeed = 0.15;
            targetSpeed = 0.15;
            gameOverText.style.display = 'none';
            pauseButton.innerText = 'Duraklat';
            isPaused = false;
            
            otherCars.forEach(car => {
                car.position.z = camera.position.z - spawnDistance - Math.random() * 50;
                car.speed = (Math.random() * 0.1) + 0.1;
            });

            environmentObjects.forEach(obj => {
                obj.position.z = camera.position.z - spawnDistance - Math.random() * 100;
            });
            
            animate();
        }
        
        function togglePause() {
            if (!gameRunning) return;
            isPaused = !isPaused;
            if (isPaused) {
                pauseButton.innerText = 'Devam Et';
                camera.fov = pauseCameraFov;
                camera.position.copy(pauseCameraPosition);
                camera.updateProjectionMatrix();
            } else {
                pauseButton.innerText = 'Duraklat';
                camera.fov = defaultCameraFov;
                camera.position.copy(defaultCameraPosition);
                camera.updateProjectionMatrix();
                animate();
            }
        }

        function onKeyDown(event) {
            if (!gameRunning) return;
            if (event.key === 'p' || event.key === 'P') {
                togglePause();
            }
            if (isPaused) return;

            if (event.key === 'ArrowLeft') {
                lateralVelocity = -maxLateralSpeed; 
            } else if (event.key === 'ArrowRight') {
                lateralVelocity = maxLateralSpeed;
            } else if (event.key === 'ArrowUp') {
                targetSpeed = maxSpeed;
            } else if (event.key === 'ArrowDown') {
                targetSpeed = minSpeed;
            }
        }

        function onKeyUp(event) {
            if (!gameRunning || isPaused) return;
            if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
                lateralVelocity = 0;
            } else if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {
                targetSpeed = playerSpeed;
            }
        }
        
        function onButtonPress(direction) {
            if (!gameRunning || isPaused) return;
            if (direction === 'left') {
                lateralVelocity = -maxLateralSpeed;
            } else if (direction === 'right') {
                lateralVelocity = maxLateralSpeed;
            } else if (direction === 'gas') {
                targetSpeed = maxSpeed;
            } else if (direction === 'brake') {
                targetSpeed = minSpeed;
            }
        }

        function onButtonRelease(direction) {
            if (!gameRunning || isPaused) return;
            if (direction === 'left' || direction === 'right') {
                lateralVelocity = 0;
            } else if (direction === 'gas' || direction === 'brake') {
                targetSpeed = playerSpeed;
            }
        }

        function update() {
            if (!gameRunning || isPaused) return;
            
            playerSpeed += (targetSpeed - playerSpeed) * 0.05;

            playerCar.position.x += lateralVelocity;
            playerCar.position.x = Math.max(playerXMin, Math.min(playerXMax, playerCar.position.x));

            const moveDistance = playerSpeed;
            
            road.position.z += moveDistance;
            if(road.position.z > camera.position.z + 10) road.position.z = camera.position.z - 1000;
            
            window.roadLines.forEach(line => {
                line.position.z += moveDistance;
                if(line.position.z > camera.position.z + despawnDistance) {
                    line.position.z -= 1000;
                }
            });

            // Araba ve çevre objelerini dinamik olarak yönetme
            otherCars.forEach((car, index) => {
                const relativeSpeed = moveDistance - car.speed;
                car.position.z += relativeSpeed;

                if (car.position.z > camera.position.z + despawnDistance) {
                    scene.remove(car);
                    otherCars.splice(index, 1);
                    spawnNewCar();
                }
            });
            
            environmentObjects.forEach((obj, index) => {
                obj.position.z += moveDistance;
                if (obj.position.z > camera.position.z + despawnDistance) {
                    scene.remove(obj);
                    environmentObjects.splice(index, 1);
                    spawnNewEnvironmentObject();
                }
            });

            checkCollisions();

            score += moveDistance * 10;
            scoreElement.innerText = Math.floor(score);
        }

        function checkCollisions() {
            const playerBox = new THREE.Box3().setFromObject(playerCar);
            otherCars.forEach(car => {
                const carBox = new THREE.Box3().setFromObject(car);
                if (playerBox.intersectsBox(carBox)) {
                    gameRunning = false;
                    gameOverText.style.display = 'block';
                }
            });
        }

        function onResize() {
            camera.aspect = gameContainer.clientWidth / gameContainer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(gameContainer.clientWidth, gameContainer.clientHeight);
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                gameContainer.requestFullscreen().catch(err => {
                    alert(`Tam ekran moduna geçilemedi: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        function animate() {
            if (gameRunning && !isPaused) {
                requestAnimationFrame(animate);
                update();
                renderer.render(scene, camera);
            }
        }

        init();
    </script>
</body>
</html>
